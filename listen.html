<!DOCTYPE html>
<html>
<head>
    <!-- Page Title and Favicon -->
    <title>starship - listening to music</title>
    <link rel="icon" type="image/x-icon" href="/uploads/branding/favicon-music.png">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/viewers.css">
    <link rel="stylesheet" href="/css/navbar.css">
    <link rel="stylesheet" href="/css/menu-m.css">

    <!-- JavaScript -->
    <script src="/javascript/menu-music.js"></script>
    <script src="/javascript/scrollbar.js"></script>

    <!-- Inline Styles -->
    <style>
        /* Body Styling */
        body {
            background-color: black;
            animation: fadeInBackground 2s ease-in-out forwards;
            margin-top: 1px;
            overflow: auto;
        }

        /* Gradient Blue Text Styling */
        .gradient-blue {
            background: linear-gradient(to right, #7eafff, #3d7eff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(61, 126, 255, 0.8);
            animation: glow-blue 1.5s infinite alternate;
            font-family: Bebas Neue;
        }

        /* Keyframes for Animations */
        @keyframes glow-blue {
            0%, 100% {
                text-shadow: 0 0 10px rgba(61, 126, 255, 0.8),
                             0 0 20px rgba(61, 126, 255, 0.8),
                             0 0 30px rgba(61, 126, 255, 0.8);
            }
            50% {
                text-shadow: 0 0 20px rgba(61, 126, 255, 1),
                             0 0 30px rgba(61, 126, 255, 1),
                             0 0 40px rgba(61, 126, 255, 1);
            }
        }

        @keyframes fadeInBackground {
            from {
                background-color: black;
            }
            to {
                background-color: black;
            }
        }

        @keyframes fadeInIframe {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Flexbox for Music Items */
        #randomMusicContainer {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }

        .music {
            flex: 0 1 150px;
            text-align: center;
            color: white;
            margin: 5px;
        }

        /* Iframe Styling */
        iframe {
            background-color: black;
            opacity: 0;
            animation: fadeInIframe 2s ease-in-out 1s forwards;
        }
    </style>
</head>

<body>
    <!-- Navigation Bar -->
    <div id="navbar"></div>
    <script src="/javascript/navbar.js"></script>

    <!-- Random Music Container -->
    <div id="randomMusicContainer"></div>

    <!-- Iframe for Music Playback -->
    <iframe id="myIframe" src="" allowfullscreen></iframe>

    <!-- Controls Section -->
    <div class="controls">
        <div class="music-info">
            <h2 class="gradient-blue"></h2>
        </div>
        <div class="buttons">
            <button id="homeButton"><i class="fa fa-home fa-lg"></i></button>
            <button id="reloadButton"><i class="fa fa-refresh fa-lg"></i></button>
            <button id="fullscreenButton"><i class="fa fa-arrows-alt fa-lg"></i></button>
        </div>
    </div>

    <!-- JavaScript for Music Controls -->
    <script>
        function redirectIframe(link, name) {
            const iframe = document.getElementById('myIframe');
            const tempLink = '/storage/loading';

            // Temporarily redirect to loading page
            iframe.src = tempLink;

            // Update the music info
            const musicInfo = document.querySelector('.music-info h2');
            musicInfo.textContent = name;
            document.title = `starship - ${name}`;

            // Set a timeout to redirect to the actual music link after 4 seconds
            setTimeout(() => {
                iframe.src = link;
            }, 4000);
        }

        window.addEventListener('load', function() {
            const musicLink = localStorage.getItem('playlistLink');
            const musicName = localStorage.getItem('playlistName');
            if (musicLink && musicName) {
                redirectIframe(musicLink, musicName);
            }

            // Set a timer to detect iframe unresponsiveness
            const iframe = document.getElementById('myIframe');
            let iframeUnresponsive = setTimeout(() => {
                iframe.src = '/errors/contentblocked';
            }, 5000);

            // Reset the timer on successful load
            iframe.addEventListener('load', () => {
                clearTimeout(iframeUnresponsive);
            });
        });

        // Iframe Controls
        const reloadButton = document.getElementById('reloadButton');
        const fullscreenButton = document.getElementById('fullscreenButton');
        const homeButton = document.getElementById('homeButton');

        reloadButton.addEventListener('click', () => {
            const iframe = document.getElementById('myIframe');
            iframe.src = iframe.src;
        });

        fullscreenButton.addEventListener('click', () => {
            const iframe = document.getElementById('myIframe');
            if (iframe.requestFullscreen) {
                iframe.requestFullscreen();
            } else if (iframe.mozRequestFullScreen) {
                iframe.mozRequestFullScreen();
            } else if (iframe.webkitRequestFullscreen) {
                iframe.webkitRequestFullscreen();
            } else if (iframe.msRequestFullscreen) {
                iframe.msRequestFullscreen();
            }
        });

        homeButton.addEventListener('click', () => {
            const currentURL = window.location.href;

            if (currentURL.includes("/storage/tv")) {
                location.replace("/tv");
            } else if (currentURL.includes("/storage/games")) {
                location.replace("/games");
            } else if (currentURL.includes("/storage/music")) {
                location.replace("/music");
            } else {
                location.replace("/games");
            }
        });
    </script>

    <!-- Particles.JS Background -->
    <div id="particles-js"></div>
    <script src="/javascript/particles.js"></script>
    <script src="/javascript/particles-config.js"></script>
    <script src="/javascript/panic.js"></script>
    <script src="/javascript/cloaking.js"></script>
    <script src="/javascript/antitabclose.js"></script>
</body>
</html>
