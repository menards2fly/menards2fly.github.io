<!DOCTYPE html>
<html>
  <head>
    <title>starship - playing a game</title>
    <link rel="icon" type="image/x-icon" href="/uploads/branding/favicon.png" />
    <link rel=stylesheet href=/css/viewers.css>
    <link rel="stylesheet" href="/css/navbar.css" />
    <link rel="stylesheet" href="/css/menu.css" />
    <script src="/javascript/menu.js"></script>
    <script src="/javascript/scrollbar.js"></script>

    <!-- Google AdSense and Google Analytics -->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4851718454212779"
      crossorigin="anonymous"
    ></script>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-ZZH4JE7RJF"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-ZZH4JE7RJF");
    </script>

    <style>
      /* Animate the body background color */
      body {
        background-color: black;
        animation: fadeInBackground 2s ease-in-out forwards;

        overflow: auto;
      }

      @keyframes fadeInBackground {
        from {
          background-color: black;
        }
        to {
          background-color: black; /* Ensure the final color is black */
        }
      }

      /* New Scale and Slide-Up Animation */
      @keyframes scaleAndSlideUp {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      /* Animate the iframe */
      iframe {
        background-color: black;
        opacity: 0;
        transform: scale(0.9) translateY(20px);
        animation: scaleAndSlideUp 1s ease-in-out forwards;
      }

      /* Animate the navbar */
      #navbar {
        opacity: 0;
        transform: scale(0.9) translateY(-30px); /* Slide from above */
        animation: scaleAndSlideUp 1s ease-in-out forwards;
      }

      /* Animate the controls */
      .controls {
        opacity: 0;
        transform: scale(0.9) translateY(20px);
        animation: scaleAndSlideUp 1s ease-in-out 1.5s forwards;
      }

      /* Animate the buttons */
      .buttons button {
        opacity: 0;
        transform: scale(0.9) translateY(20px);
        animation: scaleAndSlideUp 0.5s ease-in-out forwards;
      }

      /* Flexbox for horizontal layout */
      #randomGameContainer {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
      }

      .game {
        flex: 0 1 150px; /* Adjust this value to control the width of the game items */
        text-align: center;
        color: white;
        margin: 5px; /* Add margin to create the gap */
      }
      body {
        font-family: Space Grotesk, sans-serif;
      }
      

* {
  scrollbar-width: none !important;
}

/* Chrome, Edge, Safari */
*::-webkit-scrollbar {
  display: none !important;
}
    </style>
  </head>

  <body>
    <div  id="navbar"></div>
    <script type="module" src="/javascript/navbar.js"></script>

    <!-- Button to toggle the random games container -->
    <!--<button id="toggleRandomGames" class="toggle-button"><i class="fa fa-shapes"></i>  Show Suggested Games</button>


        <div id="randomGameContainer" class="collapsed                                                                              "></div>-->

    <div class="game-container">
      <iframe id="myIframe" src="" allowfullscreen></iframe>
      <div class="controls">
        <div class="game-info">
          <!-- Game details (image and name) floated to the left -->
          <div class="game-details">
            <img src="" alt="Game Icon" class="game-img" />
            <h2 class="gradient-red">Game Title</h2>
          </div>
          <!-- Buttons floated to the right -->
          <div class="buttons">
            <button id="homeButton"><i class="fa fa-home fa-lg"></i></button>
            <!-- Add this where you want the like/dislike counter to appear -->

  <button id="likeBtn" title="Like" style="font-size:1.2em;">üëç <span id="likeCount">0</span></button>
  <button id="dislikeBtn" title="Dislike" style="font-size:1.2em;">üëé <span id="dislikeCount">0</span></button>

            <button id="reloadButton">
              <i class="fa fa-refresh fa-lg"></i>
            </button>
            <button id="fullscreenButton">
              <i class="fa fa-arrows-alt fa-lg"></i>
            </button>
            <button id="shareButton">
              <i class="fa fa-share-nodes fa-lg"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Container for random games -->
<!-- Share Popup -->
<div id="sharePopup" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.6); z-index:9999; align-items:center; justify-content:center;">
  <div style="background:#181818; color:white; border-radius:16px; padding:32px 24px; min-width:320px; max-width:90vw; box-shadow:0 4px 32px #000a;">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <span id="shareGameTitle" style="font-size:1.2em; font-weight:bold;"></span>
      <button id="closeSharePopup" style="background:none; border:none; color:white; font-size:1.5em; cursor:pointer;">&times;</button>
    </div>
    <div style="margin:18px 0 10px 0; text-align:center;">
      <span>You're about to share "<span id="shareGameName"></span>"</span> </i>
    </div>
    <div style="display:flex; gap:24px; justify-content:center; margin:18px 0;">
      <button id="copyShareLink" title="Copy to clipboard" style="background:none; border:none; color:white; font-size:2em; cursor:pointer;">
        <i class="fa fa-clipboard"></i>
      </button>
      <button id="mailShareLink" title="Share via Email" style="background:none; border:none; color:white; font-size:2em; cursor:pointer;">
        <i class="fa fa-envelope"></i>
      </button>
    </div>
    <div style="font-size:0.95em; color:#aaa; text-align:center; margin-top:10px;">
      sharing via stardrop  <i class="fa-solid fa-tower-broadcast"></i>
    </div>
    <div id="sharePopupMsg" style="font-size:0.95em; color:#7fff7f; text-align:center; margin-top:10px; display:none;"></div>
  </div>
</div>

    <script>
      function redirectIframe(link, name) {
        const iframe = document.getElementById("myIframe");
        const tempLink = "/storage/loading";

        // Temporarily redirect to loading page
        iframe.src = tempLink;

        // Update the game info
        const gameInfo = document.querySelector(".game-info h2");
        const gameImage = document.querySelector(".game-info img");
        const savedImage = localStorage.getItem("gameImage"); // Retrieve the saved game image

        gameInfo.textContent = name;
        if (savedImage) {
          gameImage.src = savedImage; // Set the game image
          gameImage.alt = name; // Set the alt text for accessibility
        }

        // Set a timeout to redirect to the actual game link after 4 seconds
        setTimeout(() => {
          iframe.src = link;
        }, 4000); // 4000 milliseconds = 4 seconds
      }

      window.addEventListener("load", function () {
        const gameLink = localStorage.getItem("gameLink");
        const gameName = localStorage.getItem("gameName");
        if (gameLink && gameName) {
          redirectIframe(gameLink, gameName);
        }

        // Set a timer to detect iframe unresponsiveness
        const iframe = document.getElementById("myIframe");
        let iframeUnresponsive = setTimeout(() => {
          iframe.src = "/errors/contentblocked"; // Redirect to error page if unresponsive
        }, 5000); // 5000 milliseconds = 5 seconds

        // Add an event listener to reset the timer on successful load
        iframe.addEventListener("load", () => {
          clearTimeout(iframeUnresponsive);
        });
      });

      // Iframe controls for viewers
      const reloadButton = document.getElementById("reloadButton");
      const fullscreenButton = document.getElementById("fullscreenButton");
      const homeButton = document.getElementById("homeButton");

      reloadButton.addEventListener("click", () => {
        const iframe = document.getElementById("myIframe");
        iframe.src = iframe.src;
      });

      fullscreenButton.addEventListener("click", () => {
        const iframe = document.getElementById("myIframe");
        if (iframe.requestFullscreen) {
          iframe.requestFullscreen();
        } else if (iframe.mozRequestFullScreen) {
          // Firefox
          iframe.mozRequestFullScreen();
        } else if (iframe.webkitRequestFullscreen) {
          // Chrome, Safari, Opera
          iframe.webkitRequestFullscreen();
        } else if (iframe.msRequestFullscreen) {
          // IE/Edge
          iframe.msRequestFullscreen();
        }
      });

      homeButton.addEventListener("click", () => {
        const currentURL = window.location.href; // Get the current URL of the page

        if (currentURL.includes("/storage/tv")) {
          location.replace("/tv"); // Redirect to the /tv page
        } else if (currentURL.includes("/storage/games")) {
          location.replace("/games"); // Redirect to the /games page
        } else if (currentURL.includes("/storage/music")) {
          location.replace("/music"); // Redirect to the /music page
        } else {
          location.replace("/games"); // Fallback redirect if no match
        }
      });

      document.addEventListener("DOMContentLoaded", () => {
        const toggleButton = document.getElementById("toggleRandomGames");
        const randomGameContainer = document.getElementById(
          "randomGameContainer"
        );

        toggleButton.addEventListener("click", () => {
          if (randomGameContainer.classList.contains("collapsed")) {
            randomGameContainer.classList.remove("collapsed");
            toggleButton.innerHTML =
              '<i class="fa-solid fa-circle-minus"></i> Hide Suggested Games';
          } else {
            randomGameContainer.classList.add("collapsed");
            toggleButton.innerHTML =
              '<i class="fa fa-shapes"></i>  Show Suggested Games';
          }
        });
      });

// ...existing code...

const shareButton = document.getElementById("shareButton");
const sharePopup = document.getElementById("sharePopup");
const closeSharePopup = document.getElementById("closeSharePopup");
const copyShareLink = document.getElementById("copyShareLink");
const mailShareLink = document.getElementById("mailShareLink");
const shareGameName = document.getElementById("shareGameName");
const shareGameTitle = document.getElementById("shareGameTitle");
const sharePopupMsg = document.getElementById("sharePopupMsg");

let shareUrl = "";

shareButton.addEventListener("click", () => {
  const gameImg = localStorage.getItem("gameImage") || "";
  const gameLink = localStorage.getItem("gameLink") || "";
  const gameName = localStorage.getItem("gameName") || "";

  shareUrl = new URL(window.location.origin + "/play");
  shareUrl.searchParams.set("gameimg", gameImg);
  shareUrl.searchParams.set("gamelink", gameLink);
  shareUrl.searchParams.set("gamename", gameName);

  shareGameName.textContent = gameName;
  shareGameTitle.textContent = "Share Game";
  sharePopupMsg.style.display = "none";
  sharePopup.style.display = "flex";
});

closeSharePopup.addEventListener("click", () => {
  sharePopup.style.display = "none";
});

copyShareLink.addEventListener("click", () => {
  navigator.clipboard.writeText(shareUrl.toString()).then(() => {
    sharePopupMsg.textContent = "Link copied to clipboard!";
    sharePopupMsg.style.display = "block";
  });
});

mailShareLink.addEventListener("click", () => {
  const subject = encodeURIComponent("Play this game on Stardrop!");
  const body = encodeURIComponent(`Check out "${shareGameName.textContent}" on Stardrop:\n${shareUrl.toString()}`);
  window.open(`mailto:?subject=${subject}&body=${body}`);
});

// Optional: close popup when clicking outside the box
sharePopup.addEventListener("click", (e) => {
  if (e.target === sharePopup) sharePopup.style.display = "none";
});

// Check for game info in URL and use it if present
(function () {
  const params = new URLSearchParams(window.location.search);
  const gameImg = params.get("gameimg");
  const gameLink = params.get("gamelink");
  const gameName = params.get("gamename");

  if (gameImg && gameLink && gameName) {
    // Clear previous game info to avoid conflicts
    localStorage.removeItem("gameImage");
    localStorage.removeItem("gameLink");
    localStorage.removeItem("gameName");

    // Set new game info
    localStorage.setItem("gameImage", gameImg);
    localStorage.setItem("gameLink", gameLink);
    localStorage.setItem("gameName", gameName);

    // Immediately load the game
    redirectIframe(gameLink, gameName);

    // Update the game info UI
    const gameInfo = document.querySelector(".game-info h2");
    const gameImage = document.querySelector(".game-info img");
    gameInfo.textContent = gameName;
    gameImage.src = gameImg;
    gameImage.alt = gameName;
  }
})();
</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>

    <script type="module">
// --- Like/Dislike logic ---
const supabaseUrl = 'https://jbekjmsruiadbhaydlbt.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpiZWtqbXNydWlhZGJoYXlkbGJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzOTQ2NTgsImV4cCI6MjA2Mzk3MDY1OH0.5Oku6Ug-UH2voQhLFGNt9a_4wJQlAHRaFwTeQRyjTSY';
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

const likeBtn = document.getElementById('likeBtn');
const dislikeBtn = document.getElementById('dislikeBtn');
const likeCount = document.getElementById('likeCount');
const dislikeCount = document.getElementById('dislikeCount');

if (likeBtn && dislikeBtn && likeCount && dislikeCount) {
  const gameId = localStorage.getItem("gameLink") || localStorage.getItem("gameName") || "unknown";
  const likeKey = `liked_${gameId}`;
  const dislikeKey = `disliked_${gameId}`;

function updateButtonStates() {
  const liked = !!localStorage.getItem(likeKey);
  const disliked = !!localStorage.getItem(dislikeKey);

  // Only disable the opposite button, never the active one
  likeBtn.disabled = false;
  dislikeBtn.disabled = false;
  if (liked) dislikeBtn.disabled = true;
  if (disliked) likeBtn.disabled = true;

  likeBtn.classList.toggle('active', liked);
  dislikeBtn.classList.toggle('active', disliked);

  // Set icon classes based on state
  const likeIcon = liked
    ? '<i class="fa-solid fa-thumbs-up"></i>'
    : '<i class="fa-regular fa-thumbs-up"></i>';
  const dislikeIcon = disliked
    ? '<i class="fa-solid fa-thumbs-down"></i>'
    : '<i class="fa-regular fa-thumbs-down"></i>';

  // Change button text for undo
  likeBtn.innerHTML = liked
    ? `${likeIcon} <span id="likeCount">${likeCount.textContent}</span>`
    : `${likeIcon} <span id="likeCount">${likeCount.textContent}</span>`;
  dislikeBtn.innerHTML = disliked
    ? `${dislikeIcon} <span id="dislikeCount">${dislikeCount.textContent}</span>`
    : `${dislikeIcon} <span id="dislikeCount">${dislikeCount.textContent}</span>`;
}

  async function loadVotes() {
    const { data, error } = await supabase
      .from('game_votes')
      .select('likes, dislikes')
      .eq('game_id', gameId)
      .single();

    if (data) {
      likeCount.textContent = data.likes;
      dislikeCount.textContent = data.dislikes;
    } else {
      await supabase.from('game_votes').insert([{ game_id: gameId, likes: 0, dislikes: 0 }], { upsert: true });
      likeCount.textContent = 0;
      dislikeCount.textContent = 0;
    }
    updateButtonStates();
  }

  likeBtn.addEventListener('click', async () => {
    const liked = !!localStorage.getItem(likeKey);
    const disliked = !!localStorage.getItem(dislikeKey);

    if (liked) {
      // Undo like
      await supabase.rpc('decrement_like', { gid: gameId });
      localStorage.removeItem(likeKey);
    } else if (!disliked) {
      // Like (only if not disliked)
      await supabase.rpc('increment_like', { gid: gameId });
      localStorage.setItem(likeKey, "1");
      localStorage.removeItem(dislikeKey);
    }
    updateButtonStates();
    loadVotes();
  });

  dislikeBtn.addEventListener('click', async () => {
    const liked = !!localStorage.getItem(likeKey);
    const disliked = !!localStorage.getItem(dislikeKey);

    if (disliked) {
      // Undo dislike
      await supabase.rpc('decrement_dislike', { gid: gameId });
      localStorage.removeItem(dislikeKey);
    } else if (!liked) {
      // Dislike (only if not liked)
      await supabase.rpc('increment_dislike', { gid: gameId });
      localStorage.setItem(dislikeKey, "1");
      localStorage.removeItem(likeKey);
    }
    updateButtonStates();
    loadVotes();
  });

  // Load votes on page load
  loadVotes();
}
    </script>
    <!-- Particles.JS start -->
    <div id="particles-js"></div>
    <script src="/javascript/particles.js"></script>
    <script src="/javascript/particles-config.js"></script>
    <script src="/javascript/panic.js"></script>
    <script src="/javascript/cloaking.js"></script>
      <script src="/javascript/notifications.js"></script>
    <script src="/javascript/antitabclose.js"></script>
    <!-- Particles.JS end -->

<script>

</script>
  </body>
</html>
